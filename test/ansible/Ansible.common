ANSIBLE_FOLDER ?= $(CURDIR)/test/ansible
REQUIREMENTS_FILE ?= $(ANSIBLE_FOLDER)/requirements.yml

.PHONY: ansible/dependencies
ansible/dependencies: $(ROLES_PATH) $(COLLECTIONS_PATH)
ifdef SSH_KEY
	eval $$(ssh-agent -s) && \
	ssh-add $(SSH_KEY) && \
	ansible-galaxy role install --force -r $(REQUIREMENTS_FILE) -p $(ROLES_PATH) && \
	ansible-galaxy collection install --force -r $(REQUIREMENTS_FILE) -p $(COLLECTIONS_PATH)
else
	ansible-galaxy role install --force -r $(REQUIREMENTS_FILE) -p $(ROLES_PATH)
	ansible-galaxy collection instal --force -r $(REQUIREMENTS_FILE) -p $(COLLECTIONS_PATH)
endif

.PHONY: ansible/clean
ansible/clean:
	rm -rf $(ROLES_PATH) $(COLLECTIONS_PATH)
