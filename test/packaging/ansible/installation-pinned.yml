---

- name: installation-pinned
  hosts: testing_hosts_linux
  become: true
  gather_facts: yes

  pre_tasks:
    - name: Initial cleanup # Only required for shared infra.
      include_role:
        name: cleanup

  tasks:
    - name: Installation tests suite
      vars:
        env_vars:
        target_agent_version: "1.39.0" # minimum version for sles 12.5,15.*,debian 11 and ubuntu 20.10,21.04,22.04

      block:

        - name: repo setup
          include_role:
            name: repo-setup

        - name: Setup config
          include_role:
            name: setup-config

        - name: install agent
          include_role:
            name: package-install-pinned

        - name: Assert version
          include_role:
            name: assert-version

      always:
        - name: Final cleanup # Only required for shared infra.
          include_role:
            name: cleanup

...
