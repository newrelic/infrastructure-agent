---

- name: zypper install infra-agent
  environment: "{{ env_vars }}"
  zypper:
    name: "newrelic-infra={{ agent_pkg_version }}"
    state: present
    oldpackage: yes
    update_cache: yes
    force: yes
  retries: 5
  delay: 60
  when: ansible_distribution_major_version == "11"

# The command generated by the zypper module is triggers an error in SLES12 OS. That's why I'm using the shell module instead. https://github.com/ansible/ansible/pull/23936/files It's not in our installed ansible version.345G
- name: zypper install infra-agent
  environment: "{{ env_vars }}"
  shell: /usr/bin/zypper --quiet --non-interactive --xmlout install --type package --auto-agree-with-licenses --no-recommends --force --oldpackage  newrelic-infra="{{ agent_pkg_version }}"
  retries: 5
  delay: 60
  when: ansible_distribution_major_version == "12"

...
