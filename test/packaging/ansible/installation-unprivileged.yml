---

- hosts: all
  become: true
  gather_facts: yes

  pre_tasks:
    - name: Initial cleanup # Only required for shared infra.
      include_role:
        name: cleanup

  tasks:
    - name: Installation tests suite
      vars:
        env_vars:
          NRIA_MODE: UNPRIVILEGED
      block:

      - name: Setup repo
        include_role:
          name: repo-setup

      - name: Setup config
        include_role:
          name: setup-config

      - name: Package install
        include_role:
          name: package-install

      - name: Assert version
        include_role:
          name: assert-version

      - name: Assert service
        include_role:
          name: assert-service

      - name: Assert rootless
        include_role:
          name: assert-rootless


      always:
        - name: Final cleanup # Only required for shared infra.
          include_role:
            name: cleanup


...
