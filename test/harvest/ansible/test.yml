---

# This tests runs harvest tests on multiple os/architectures.
# It will clone locally the specified `agent_version` of the agent locally, build the harvest tests binaries
# for specified architectures/os combinations and copy and run them in the testing_hosts hosts

- hosts: test_runner
  become: false
  gather_facts: yes
  connection: local

  tasks:
    - name: Checkout agent and build harvest tests for all os/arch combinations
      block:
        - name: checkout agent
          include_role:
            name: checkout

        - name: build harvest tests
          include_role:
            name: build-harvest-tests


- hosts: testing_hosts
  become: false
  gather_facts: yes

  tasks:
    - name: Print all available facts
      ansible.builtin.debug:
        var: ansible_facts

    - name: copy and run harvest tests
      include_role:
        name: run-harvest-tests

...