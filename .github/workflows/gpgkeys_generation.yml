name: GPG Key Generation (Test)

on:
  workflow_dispatch:
    inputs:
      test_message:
        description: 'Test message to display'
        required: false
        default: 'Hello from GPG workflow test!'
        type: string
  push:
    branches:
      - gpgWorkflow

jobs:
  generate-gpg-keys:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup GPG
        run: |
          echo "GPG Version:"
          gpg --version
          echo "Creating GPG directory..."
          mkdir -p ~/.gnupg
          chmod 700 ~/.gnupg
      
      - name: Generate GPG Keys
        env:
          OHAI_GPG_PASSPHRASE: ${{ secrets.OHAI_GPG_PASSPHRASE }}
          GPG_KEY_NAME: "New Relic Infrastructure Agent"
          GPG_KEY_EMAIL: "infrastructure-eng@newrelic.com"
        run: |
          chmod +x .github/workflows/scripts/gpgkeys_generation.sh
          .github/workflows/scripts/gpgkeys_generation.sh
      
      - name: Verify generated keys
        run: |
          echo "Verifying generated files..."
          ls -lh gpg-*.asc
          echo ""
          echo "Public key preview:"
          head -n 5 gpg-public-key.asc
          echo ""
          echo "Keys generated successfully!"
