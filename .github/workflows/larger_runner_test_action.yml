name: Test Runner Specs - ubuntu-latest-4-cores

# This workflow can be triggered manually from any branch
on:
  workflow_dispatch:
    inputs:
      test_description:
        description: 'Optional test description'
        required: false
        default: 'Testing ubuntu-latest-4-cores runner specs'
  # Optionally trigger on push to specific branches (uncomment if needed)
  # push:
  #   branches: [ "feature/*", "test/*" ]

jobs:
  test-runner-specs:
    runs-on: ubuntu-latest-4-cores
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Print test info
      run: |
        echo "🧪 Test Description: ${{ github.event.inputs.test_description || 'Testing ubuntu-latest-4-cores runner specs' }}"
        echo "📋 Branch: ${{ github.ref_name }}"
        echo "👤 Triggered by: ${{ github.actor }}"
        echo "⏰ Started at: $(date)"
        echo "----------------------------------------"
    
    - name: System Information
      run: |
        echo "🖥️  SYSTEM INFORMATION"
        echo "===================="
        echo "Hostname: $(hostname)"
        echo "Kernel: $(uname -r)"
        echo "OS Release:"
        cat /etc/os-release | head -5
        echo ""
        
    - name: Hardware Specifications  
      run: |
        echo "⚙️  HARDWARE SPECS"
        echo "================="
        echo "CPU Information:"
        echo "  Cores: $(nproc)"
        echo "  Model: $(lscpu | grep 'Model name' | cut -d: -f2 | xargs)"
        echo "  Architecture: $(lscpu | grep 'Architecture' | cut -d: -f2 | xargs)"
        echo "  CPU MHz: $(lscpu | grep 'CPU MHz' | cut -d: -f2 | xargs)"
        echo ""
        echo "Memory Information:"
        echo "  Total RAM: $(free -h | awk '/^Mem:/ {print $2}')"
        echo "  Available RAM: $(free -h | awk '/^Mem:/ {print $7}')"
        echo "  Memory Details:"
        free -h
        echo ""
        
    - name: Disk Space Analysis
      run: |
        echo "💾 DISK SPACE INFORMATION"
        echo "========================"
        echo "Disk Usage Summary:"
        df -h
        echo ""
        echo "Root Directory Usage:"
        du -sh /* 2>/dev/null | sort -hr | head -10
        echo ""
        echo "Available space in key directories:"
        echo "  /tmp: $(df -h /tmp | awk 'NR==2{print $4}')"
        echo "  /home: $(df -h /home | awk 'NR==2{print $4}')"
        echo "  /var: $(df -h /var | awk 'NR==2{print $4}')"
        
    - name: Network and Environment
      run: |
        echo "🌐 NETWORK & ENVIRONMENT"
        echo "======================="
        echo "Network interfaces:"
        ip -brief addr show
        echo ""
        echo "Environment variables (GitHub-related):"
        env | grep GITHUB | head -10
        echo ""
        echo "Runner environment:"
        echo "  Runner OS: $RUNNER_OS"
        echo "  Runner Arch: $RUNNER_ARCH"  
        echo "  Runner Name: $RUNNER_NAME"
        echo "  Workspace: $GITHUB_WORKSPACE"
        
    - name: Performance Test
      run: |
        echo "🚀 PERFORMANCE TEST"
        echo "=================="
        echo "Running CPU stress test (10 seconds)..."
        timeout 10s yes > /dev/null &
        timeout 10s yes > /dev/null &
        timeout 10s yes > /dev/null &
        timeout 10s yes > /dev/null &
        wait
        echo "CPU stress test completed"
        echo ""
        echo "Load average after test:"
        uptime
        echo ""
        echo "Memory usage after test:"
        free -h | grep Mem
        
    - name: Installed Tools
      run: |
        echo "🛠️  PRE-INSTALLED TOOLS"
        echo "====================="
        echo "Docker: $(docker --version 2>/dev/null || echo 'Not installed')"
        echo "Git: $(git --version)"
        echo "Node.js: $(node --version 2>/dev/null || echo 'Not installed')"
        echo "Python: $(python3 --version 2>/dev/null || echo 'Not installed')"
        echo "Java: $(java --version 2>/dev/null | head -1 || echo 'Not installed')"
        echo "Go: $(go version 2>/dev/null || echo 'Not installed')"
        echo "Ruby: $(ruby --version 2>/dev/null || echo 'Not installed')"
        
    - name: Test Summary
      run: |
        echo "✅ TEST COMPLETED SUCCESSFULLY"
        echo "============================="
        echo "Runner: ubuntu-latest-4-cores"
        echo "Branch tested: ${{ github.ref_name }}"
        echo "Completed at: $(date)"
        echo ""
        echo "Key specs confirmed:"
        echo "  ✓ CPU cores: $(nproc)"
        echo "  ✓ Total RAM: $(free -h | awk '/^Mem:/ {print $2}')"
        echo "  ✓ Available disk: $(df -h / | awk 'NR==2{print $4}')"
        echo ""
        echo "🎉 Ready for production use!"